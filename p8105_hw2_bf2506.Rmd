---
title: "p8105_hw2_bf2506"
output: html_document
date: "2022-09-29"
---
```{r load tidyverse, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(magrittr)
```


### Problem 2

##### 1.Read and clean Mrtrash_data
```{r read Mrtrash_wheel_data, message=FALSE, warning=FALSE, include=FALSE}
raw_Mrtrash_wheel_data =  
  readxl::read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
  sheet = "Mr. Trash Wheel",
  range = "A2:N533",
  na = c("", "Decemeber Total", "November Total", "October Total", "September Total", "August Total", "July Total", "June Total", "May Total", "April Total", "March Total", "February Total", "January Total")
)
Mrtrash_wheel_data = drop_na(raw_Mrtrash_wheel_data, Dumpster)

```

```{r rename and integer sportsballs in Mr, message=FALSE, warning=FALSE, include=FALSE}

Mrtrash_wheel_data = janitor::clean_names(Mrtrash_wheel_data) %>% rename(volume_cubicyards = volume_cubic_yards) %>% mutate(sports_balls=as.integer(sports_balls)) 

```

##### 2.Read and clean Professortrash_data
```{r read Professortrash_wheel_data, message=FALSE, warning=FALSE, include=FALSE}
raw_Professortrash_wheel_data = 
  readxl::read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
  sheet = "Professor Trash Wheel", 
  range = "A2:N115", 
  na = c("", "Decemeber Total", "November Total", "October Total", "September Total", "August Total", "July Total", "June Total", "May Total", "April Total", "March Total", "February Total", "January Total")
)

Professortrash_wheel_data = drop_na(raw_Professortrash_wheel_data, Dumpster)

```

```{r rename and integer sportsballs in PRO, message=FALSE, warning=FALSE, include=FALSE}

Professortrash_wheel_data = janitor::clean_names(Professortrash_wheel_data) %>% rename(volume_cubicyards = volume_cubic_yards) %>% mutate(sports_balls = as.integer(sports_balls)) 

```


##### 3.Combine two tables
```{r combine tables, message=FALSE, warning=FALSE, include=FALSE}
Mrtrash_wheel_data = 
  mutate(Mrtrash_wheel_data, trash_wheel = "Mr_Trash_Wheel")

Professortrash_wheel_data =
  mutate(Professortrash_wheel_data, trash_wheel = "Professor_Trash_Wheel")

Trash_Wheel_data = 
  bind_rows(Mrtrash_wheel_data, Professortrash_wheel_data) %>% relocate(trash_wheel)

```

**Describe the Data form Trash_Wheel_data**
 
The size of the dataset is **`r ncol(Trash_Wheel_data)` variables** and **`r nrow(Trash_Wheel_data)` observations**, showing the summary of trash collection from two trash wheel(Mr.trash wheel and Professor trash wheel). And the total weight of trash collected by Professor Trash Wheel is`r sum(Professortrash_wheel_data$weight_tons)` and the total number of sports balls collected by Mr. Trash Wheel in 2020 is `r sum(filter(Mrtrash_wheel_data, year == 2020)$sports_balls)`

**15** variables are as following:  
**·trash_wheel**: whether from "Mr_Trash_Wheel" or "	
Professor_Trash_Wheel"

**·dumpster**: the number of dumpsters 

**·"month"**: the month that collect the data, from Jan to Dec

**·"year" **: the year that collect the data

**·"date" **: the date that collect the data

**·"weight_tons"**: weight in tons

**·"volume_cubicyards"**: volume in cubic yards

**·"plastic_bottles"**:  the number of plastic bottles

**·"polystyrene"**: the number of polystyrene

**·"cigarette_butts"**: the number of cigarette butts 

**·"glass_bottles"**: the number of glass bottles 

**·"grocery_bags"**: the number of grocery bags 

**·"chip_bags"**: the number of chip bags

**·"sports_balls"**：the number of sports balls

**·"homes_powered"**: the number of homes powered by  electricity generated from these trash

### Problem 3

##### 1.Clean the data in pols-month.csv
```{r read and clean  pols_month_data, message=FALSE, warning=FALSE, include=FALSE}
pols_month_data=
  read_csv("./data/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day"), sep = "\\-") %>% 
  mutate( year = as.integer(year), month = as.integer(month), day = as.integer(day)) %>% 
  mutate( month = replace(month, month == c(1,2,3,4,5,6,7,8,9,10,11,12), c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))) %>%
  mutate(president = ifelse(prez_gop - prez_dem > 0, "gop", "dem")) %>% 
  select(-c(prez_gop, prez_dem, day))

```

##### 2.Clean the data in snp.csv
```{r read and clean  snp_data, message=FALSE, warning=FALSE, include=FALSE}

snp_data_1 =
  read_csv("./data/snp.csv", n_max = 175) %>%
  janitor::clean_names() %>% 
  separate(date, into = c("year", "month", "day"), sep = "\\/") %>% 
  select(-day) %>% 
  mutate( year = as.integer(year), month = as.integer(month)) %>% 
  mutate( year = as.integer(year + 2000))

snp_data_2 =
  read_csv("./data/snp.csv", skip = 176, col_names = FALSE) %>% 
  separate(X1, into = c("month", "day", "year"), sep = "\\/") %>% 
  select(-day) %>% 
  rename(close = X2) %>% 
  relocate(year) %>% 
  mutate( year = as.integer(year), month = as.integer(month)) %>% 
  mutate(year = ifelse(year == 0, as.integer(year + 2000), as.integer(year + 1900)))

snp_data = 
  bind_rows(snp_data_1, snp_data_2) %>% 
  janitor::clean_names() %>% 
  arrange(year, month)  %>% 
  mutate( month = recode(month, `1` = "Jan", `2` = "Feb", `3` = "Mar", `4` = "Apr", `5` = "May", `6` = "Jun", `7` = "Jul", `8` = "Aug", `9` = "Sep", `10` = "Oct", `11` = "Nov", `12` = "Dec"))

```

##### 3.Tidy unemployment data

```{r read and clean and tidy unemployment_data, message=FALSE, warning=FALSE, include=FALSE}
unemployment_data = 
  read_csv("./data/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(jan:dec, names_to = "month", values_to = "unemployment_percentage") %>% 
  mutate(month = sub("(.)", "\\U\\1", month, perl = TRUE))

```

##### 4.Joint pols_month/snp/unemployment tables

```{r joint tables, message=FALSE, warning=FALSE, include=FALSE}

pols_snp_unemployment_data = 
  left_join(pols_month_data, snp_data, by = c("year", "month")) %>% 
  left_join(unemployment_data, by = c("year", "month"))
#时间格式不确定
#月份加不加起来
```

### Problem 1

##### 1.Read and clean and select NYC_subway_data
```{r read and clean and select NYC_subway_data, include=FALSE}
NYC_subway_data = 
  read_csv(
    "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv",
    col_types = cols(Route8 = "c", Route9 = "c", Route10 = "c", Route11 = "c")) %>% 
  janitor::clean_names() %>% 
  select(
    line, station_name, station_latitude, station_longitude, 
    starts_with("route"), entry, exit_only, vending, entrance_type, ada) %>% 
  mutate(entry = ifelse(entry == "YES", TRUE, FALSE))
```

##### 2.Describe NYC_subway_data
I import data from `NYC_Transit_Subway_Entrance_And_Exit_Data.csv`. The process begins with data import, updates variable names, and selects the columns that will be used in later parts. We update `entry` from `yes` / `no` to a logical variable. As part of data import, we specify that `Route` columns 8-11 should be character for consistency with 1-7.(`r nrow(NYC_subway_data)`rows x `r ncol(NYC_subway_data)`columns)